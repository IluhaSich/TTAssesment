<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Стили Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7"
          crossorigin="anonymous">
</head>
<body class="d-flex flex-column h-100">
<div class="container mt-4">
    <h1>Итоговые баллы групп</h1>

    <form th:action="@{/grades/total}" method="get" class="mb-4">
        <div class="row align-items-end">
            <div class="col-md-3">
                <label class="form-label">Специализация</label>
                <select name="setting" class="form-select">
                    <option value="">Все специализации</option>
                    <option th:each="s : ${T(com.project.tta.models.Setting).values()}"
                            th:value="${s}"
                            th:text="${s.displayName}"
                            th:selected="${setting == s}">Бакалавриат</option>
                </select>
            </div>

            <input type="hidden" name="sortBy" th:value="${sortBy}" />
            <input type="hidden" name="sortOrder" th:value="${sortOrder}" />
            <input type="hidden" name="page" th:value="${currentPage}" />
            <input type="hidden" name="size" th:value="${size}" />

            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Фильтровать</button>
            </div>
        </div>
    </form>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>
                <a th:href="@{/grades/total(
                            setting=${setting},
                            sortBy='groupName',
                            sortOrder=${sortOrder == 'asc' ? 'desc' : 'asc'}
                        )}">
                    Группа
                    <span th:if="${sortBy == 'groupName'}" th:text="${sortOrder == 'asc' ? '↑' : '↓'}"></span>
                </a>
            </th>
            <th>
                <a th:href="@{/grades/total(
                            setting=${setting},
                            sortBy='score',
                            sortOrder=${sortOrder == 'asc' ? 'desc' : 'asc'}
                        )}">
                    Итоговый балл
                    <span th:if="${sortBy == 'score'}" th:text="${sortOrder == 'asc' ? '↑' : '↓'}"></span>
                </a>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="score : ${totalScores}">
            <td>
                <a th:href="@{/grades/{link}(link=${score.link})}"
                   th:text="${score.groupName}">
                </a>
            </td>
            <td th:text="${score.totalScore} + '/100'"></td>
        </tr>
        </tbody>
    </table>

    <div class="d-flex justify-content-center mt-4">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li th:classappend="${currentPage == 0} ? 'disabled' : ''" class="page-item">
                    <a class="page-link" th:href="@{/grades/total(
                            setting=${setting},
                            sortBy=${sortBy},
                            sortOrder=${sortOrder},
                            page=${currentPage - 1}
                        )}" aria-label="Previous">
                        <span aria-hidden="true">«</span>
                    </a>
                </li>

                <li th:each="page : ${#numbers.sequence(
                        currentPage < 5 ? 1 : pageCount - currentPage < 3 ? (pageCount >= 5 ? pageCount - 5 : 1) : currentPage - 2,
                        pageCount - currentPage < 3 ? pageCount : currentPage < 5 ? (pageCount >= 5 ? 5 : pageCount) : currentPage + 3
                    )}"
                    th:classappend="${page-1 == currentPage} ? 'active' : ''"
                    class="page-item">
                    <a class="page-link" th:href="@{/grades/total(
                            setting=${setting},
                            sortBy=${sortBy},
                            sortOrder=${sortOrder},
                            page=${page - 1}
                        )}" th:text="${page}">1</a>
                </li>

                <li th:classappend="${currentPage == pageCount - 1} ? 'disabled' : ''" class="page-item">
                    <a class="page-link" th:href="@{/grades/total(
                            setting=${setting},
                            sortBy=${sortBy},
                            sortOrder=${sortOrder},
                            page=${currentPage + 1}
                        )}" aria-label="Next">
                        <span aria-hidden="true">»</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>
</body>
</html>

<!--<div class="d-flex justify-content-around bd-highlight">-->
<!--    <nav aria-label="Page navigation">-->
<!--        <ul class="pagination">-->
<!--            &lt;!&ndash; Ссылка "Назад" &ndash;&gt;-->
<!--            <li th:class="${currentPage == 0} ? 'page-item disabled' : 'page-item'">-->
<!--                <a class="page-link"-->
<!--                   th:href="@{/grades/total(sortBy=${sortBy}, sortOrder=${sortOrder}, page=${currentPage - 1})}"-->
<!--                   aria-label="Previous">-->
<!--                    <span aria-hidden="true">«</span>-->
<!--                </a>-->
<!--            </li>-->

<!--            &lt;!&ndash; Номера страниц &ndash;&gt;-->
<!--            <li th:class="${page == currentPage + 1} ? 'page-item active' : 'page-item'"-->
<!--                th:each="page : ${#numbers.sequence(currentPage < 5 ? 1 : totalPages - currentPage < 3 ? (totalPages >= 5 ? totalPages - 5 : 1) : currentPage - 2, totalPages - currentPage < 3 ? totalPages : currentPage < 5 ? (totalPages >= 5 ? 5 : totalPages) : currentPage + 3)}">-->
<!--                <a class="page-link"-->
<!--                   th:href="@{/grades/total(sortBy=${sortBy}, sortOrder=${sortOrder}, page=${page - 1})"-->
<!--                   th:text="${page}">1</a>-->
<!--            </li>-->

<!--            &lt;!&ndash; Ссылка "Вперед" &ndash;&gt;-->
<!--            <li th:class="${currentPage == totalPages - 1} ? 'page-item disabled' : 'page-item'">-->
<!--                <a class="page-link"-->
<!--                   th:href="@{/grades/total(sortBy=${sortBy}, sortOrder=${sortOrder}, page=${currentPage + 1})}"-->
<!--                   aria-label="Next">-->
<!--                    <span aria-hidden="true">»</span>-->
<!--                </a>-->
<!--            </li>-->
<!--        </ul>-->
<!--    </nav>-->
<!--</div>-->
<!--</body>-->
<!--</html>-->